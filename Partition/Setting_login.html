<style>

</style>
<div id="fb-root"></div>

<div class="settingregpage page " style="background-image:url('img/launch_bg.jpg');background-repeat:no-repeat;background-size:100% 100%">
    <div class="page__hd " style="height:5%;padding:0;margin:0;">
    </div>
    <div class="page__bd" style="height:80%">
        <div style="left: 50%; width: 90%; height: 100%; margin: 10% auto;background-color:#f4f4f4;border-radius:0.5em;overflow-y:auto" id="loginform">
            <div class="weui-flex" style="height: 20%;">
                <div class="weui-flex__item" style="height: 90%;background-image: url('img/icon/logo.png');background-repeat:no-repeat;-webkit-background-size:auto 100%  ;background-position:center;position:relative;top:58%;transform:translateY(-50%)">

                </div>
            </div>


            <p style="text-align:center;line-height:10vh">萍水相逢，遇見您傾心的陪陪!</p>



            <div id="loginbyself" style="display:none">
                <div class="weui-cells  ">
                    <div class="weui-cell ">

                        <div class="weui-cell__hd"><label class="weui-label" style="text-align:center;margin-right:5px;">Email</label></div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" name="Email" type="email" placeholder="請輸入Email">
                        </div>

                    </div>

                    <!--<div class="weui-cell">
                <div class="weui-cell__hd"><label class="weui-label" style="text-align:center;margin-right:5px;">會員密碼</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input" name="Pw" type="password" maxlength="20" placeholder="請輸入密碼">
                </div>
                <div class="weui-cell__ft">
                    <a href="javascript:;" class="weui-btn weui-btn_mini weui-btn_primary" onclick="forgetpw()">忘記密碼</a>

                </div>
            </div>-->

                    <div class="weui-cell ">
                        <div class="weui-cell__hd">
                            <label class="weui-label weui-btn weui-btn_mini weui-btn_primary" style="font-size:12px;word-break:keep-all;margin-right:5px;" onclick="sendvcode()">發送驗證碼</label>
                        </div>
                        <div class="weui-cell__bd">
                            <input class="weui-input" name="VCode" type="text" pattern="[0-9]*" maxlength="6" placeholder="請輸入Email驗證碼">
                        </div>

                    </div>

                </div>
                <div class="weui-btn-area regbtn" style="display: flex;height:48px">
                    <a class="weui-btn weui-btn_default" style="flex:1" onclick="loginlist()">返回</a>
                    <a class="weui-btn weui-btn_primary " style="flex:1;margin-top:0" href="javascript:" onclick="login();">立即登入</a>
                    <a class="weui-btn weui-btn_primary weui-btn_loading " style="display:none" href="javascript:"><i class="weui-loading"></i>立即登入</a>
                </div>
                <div class="weui-btn-area">
                    <!--<a class="weui-btn weui-btn_default" style="" href="javascript:" onclick="clicknav(this)" btag="Setting_Reg">建立新帳號</a>-->
                    <a class="weui-btn weui-btn_default" style="" href="javascript:" onclick="clicknav(this)" btag="Setting_Reg">馬上註冊</a>
                </div>
            </div>
            <div id="loginbtnlist">
                <div class="weui-btn-area">
                    <img style="width:90%;height:auto;position:relative;left:50%;transform:translateX(-50%)" onclick="beforelogin('Facebook')" src="img/icon/fb_logo.png" />
                </div>
                <div class="weui-btn-area">
                    <img style="width:90%;height:auto;position:relative;left:50%;transform:translateX(-50%)" onclick="beforelogin('Google')" src="img/icon/g_logo.png" />
                </div>
                <div class="weui-btn-area" style="">
                    <img style="width:90%;height:auto;position:relative;left:50%;transform:translateX(-50%)" onclick="beforelogin('LINE')" src="img/icon/LINE.png" />
                    <!--<a class="weui-btn weui-btn_default" style="width:90%;" onclick="loginself()">傾心帳號登入</a>-->

                </div>
            </div>
            <!--<div class=" weui-cells_checkbox">
        <label class="weui-cell " for="s11">
            <div class="weui-cell__hd"  style="margin: 0 auto;font-size:3.5vw">
                <input type="checkbox" class="weui-check" name="checkbox1" id="s11">
                <i class="weui-icon-checked"></i>
                <span style="text-align:center;color:gray;">請詳細閱讀並同意傾心陪玩的<a href="javascript:;" onclick="seerule()">服務條款(EULA)</a></span>
            </div>

        </label>

    </div>-->
            <!--<input type="checkbox" class="weui-check" name="checkbox1" id="s11" checked="checked">-->
            <p style="text-align:center;color:gray;font-size:10px">登入則表示同意傾心的<a href="javascript:;" onclick="seerule()">服務條款(EULA)</a></p>

        </div>
    </div>
    <div class="page__ft ">
        <div class="js_dialog" id="servicedia" style="display:none">
            <div class="weui-mask" onclick='$("#servicedia").hide()'></div>
            <div class="weui-dialog">
                <div class="weui-dialog__bd" style="height:300px;overflow-y:auto;text-align:left"></div>
                <div class="weui-dialog__ft">
                    <a onclick='$("#servicedia").hide()' class="weui-dialog__btn weui-dialog__btn_primary">同意</a>
                </div>
            </div>
        </div>
        <div id="dialogs">
            <div class="js_dialog" id="Reg_Wran" style="display: none;">
                <div class="weui-mask"></div>
                <div class="weui-dialog">
                    <div class="weui-dialog__bd" id="Reg_Wran_Msg"></div>
                    <div class="weui-dialog__ft">
                        <a href="javascript:;" onclick="$('#Reg_Wran').fadeOut(200)" class="weui-dialog__btn weui-dialog__btn_primary">確認</a>
                    </div>
                </div>
            </div>


        </div>
        <!--<div class="weui-btn-area">
            <a class="weui-btn weui-btn_warn" style="" href="javascript:" onclick="reloadidx();">App重新載入</a>
        </div>-->
    </div>
    <script>
        function beforelogin(type) {
            //if ($("#s11:checked").length == 0) {
            //    alert("請先同意傾心陪玩的服務條款(EULA)");
            //    return;
            //} else {
            //    Bridge.signIn(type)
            //}
            Bridge.signIn(type)
        }
        function forgetpw() {
            var ma = $("#loginform [name=Email]").val();
            if (ma == "") {
                alert("請先填Email才能重置密碼")
            }
        }
        function loginlist() {
            $("#loginbyself").slideUp("fast", function () {
                $("#loginbtnlist").slideDown("fast")
            });
        }

        function loginself() {
            $("#loginbtnlist").slideUp("fast", function () {
                $("#loginbyself").slideDown("fast")
            });
        }
        function seerule() {
            Bridge.readFile("Template/servicerule.txt", function (st) {
                $("#servicedia .weui-dialog__bd").empty();
                var stline = st.split('\r');
                for (var i = 0; i < stline.length; i++) {
                    if (stline[i].trim() != "")
                        $("#servicedia .weui-dialog__bd").append("<p>" + stline[i] + "</p><br>")
                }

                $("#servicedia").show();

            });
        }
        function sendvcode() {
            var reg= /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,24}))$/
            //var reg = /^\w+((.\w+)|(-\w+))@[A-Za-z0-9]+((.|-)[A-Za-z0-9]+).[A-Za-z0-9]+$/; //正则表达式
            var obj = $("#loginform [name=Email]"); //要验证的对象
            if (obj.val() === "") { //输入不能为空
                alert("EMAIL不能為空!");
                return false;
            } else if (!reg.test(obj.val())) { //正则验证不通过，格式不对
                alert("EMAIL格式錯誤!");
                return false;
            }
            $.ajax({
                url: ajaxurl + "SendVCode",
                type: 'post',
                data: { Email: obj.val(), UsePlace: "Login" },
                timeout: 30000,
                success: function (r) {
                    if (r.result_status) {
                        alert("發送成功,60秒後若沒收到驗證請再重新發送!");
                    } else {
                        alert(r.result_message);
                    }
                },
                error: function () {
                    alert("網路錯誤")
                }
            });
        }
        function reloadidx() {
            var ws = plus.webview.currentWebview();
            ws.loadURL(debugurl + "index.html?" + Math.random());
        }
        function login() {
            var reg = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,24}))$/

           // var reg = /^\w+((.\w+)|(-\w+))@[A-Za-z0-9]+((.|-)[A-Za-z0-9]+).[A-Za-z0-9]+$/; //正则表达式
            var obj = $("#loginform [name=Email]"); //要验证的对象
            if (obj.val() === "") { //输入不能为空
                alert("EMAIL不能為空!");
                return false;
            } else if (!reg.test(obj.val())) { //正则验证不通过，格式不对
                alert("EMAIL格式錯誤!");
                return false;
            }

            var data = {};

            data["Email"] = $("#loginform [name=Email]").val();
           // data["Pw"] = $("#loginform [name=Pw]").val();
            data["VCode"] = $("#loginform [name=VCode]").val();
            //alert(JSON.stringify(data));
            $("#loginform .weui-cell").removeClass("weui-cell_warn");

         

            //if (data["Pw"].length < 6) {
            //    $("#loginform [name=Pw]").parents(".weui-cell").addClass("weui-cell_warn");
            //    $("#Reg_Wran_Msg").text("密碼需要大於6位");
            //    $("#Reg_Wran").show();
            //    return;
            //}

            //$(".regbtn a").toggle();
            $.ajax({
                url: ajaxurl + "Login",
                type: 'post',
                data: data,
                timeout: 30000,
                success: function (r) {
                    if (r.result_status) {

                        Server_Token = JSON.stringify(r.result_content);

                        Bridge.setData("Server_Token", Server_Token, function () {
                            var ws = plus.webview.currentWebview();
                            ws.loadURL("index.html?" + Math.random());
                        });
                    } else {
                        $("#Reg_Wran_Msg").text(r.result_message);
                        $("#Reg_Wran").show();
                        //  $(".regbtn a").toggle();
                    }
                },
                error: function () {
                    $("#Reg_Wran_Msg").text("網路錯誤");
                    $("#Reg_Wran").show();
                    //  $(".regbtn a").toggle();
                }
            });
        }
        $(function () {
            plus.nativeUI.closeWaiting()
            if (plus.webview.getWebviewById("loading")) {
                plus.webview.getWebviewById("loading").close()
            }
            var chkview = plus.nativeObj.View.getViewById("starget")
            if (chkview != null) {
                chkview.close();
            }
            $("#idxtab").hide();
            $(".weui-navbar").hide();
            Bridge.settokenCallback(function (from, key) {
                plus.nativeUI.showWaiting("驗證中...");
                console.dir("from:" + from)
                console.dir("key:" + key)
                $.ajax({
                    url: ajaxurl + "thirdLogin",
                    type: 'post',
                    data: { from: from, key: key },
                    timeout: 30000,
                    success: function (r) {
                        if (r.result_status) {

                            Server_Token = JSON.stringify(r.result_content);

                            Bridge.setData("Server_Token", Server_Token, function () {
                                plus.nativeUI.closeWaiting();
                                var ws = plus.webview.currentWebview();
                                ws.loadURL("index.html?" + Math.random());
                            });
                        } else {
                            $("#Reg_Wran_Msg").text(r.result_message);
                            $("#Reg_Wran").show();
                            plus.nativeUI.closeWaiting();
                            //  $(".regbtn a").toggle();
                        }
                    },
                    error: function () {
                        $("#Reg_Wran_Msg").text("網路錯誤");
                        $("#Reg_Wran").show();
                        plus.nativeUI.closeWaiting();
                        //  $(".regbtn a").toggle();
                    }
                });
            })
           

        });


    </script>
</div>
